<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Coding Practices | Proctor Foundation Data Science Handbook</title>
  <meta name="description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Coding Practices | Proctor Foundation Data Science Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Coding Practices | Proctor Foundation Data Science Handbook" />
  
  <meta name="twitter:description" content="This is a handbook to help summarize best practices in data science among team members at the Francis I. Proctor Foundation. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Contributors (many from UC Berkeley in addition to Proctor): Ben Arnold, Jade Benjamin-Chung, Kunal Mishra, Anna Nguyen, Nolan Pokpongkiat, Stephanie Djajadi" />


<meta name="date" content="2019-10-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="directory-structure-and-code-repositories.html"/>
<link rel="next" href="codingstyle.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Proctor Data Science Handbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction: Work Flow and Reproducible Analyses</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#workflow"><i class="fa fa-check"></i><b>1.1</b> Workflow</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#reproducibility"><i class="fa fa-check"></i><b>1.2</b> Reproducibility</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#automation"><i class="fa fa-check"></i><b>1.3</b> Automation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="workflows.html"><a href="workflows.html"><i class="fa fa-check"></i><b>2</b> Workflows</a></li>
<li class="chapter" data-level="3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html"><i class="fa fa-check"></i><b>3</b> Directory Structure and Code Repositories</a><ul>
<li class="chapter" data-level="3.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#small-and-large-projects"><i class="fa fa-check"></i><b>3.1</b> Small and large projects</a></li>
<li class="chapter" data-level="3.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#directory-structure"><i class="fa fa-check"></i><b>3.2</b> Directory Structure</a><ul>
<li class="chapter" data-level="3.2.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#first-level-data-and-analyses"><i class="fa fa-check"></i><b>3.2.1</b> First level: data and analyses</a></li>
<li class="chapter" data-level="3.2.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#second-level-data"><i class="fa fa-check"></i><b>3.2.2</b> Second level: data</a></li>
<li class="chapter" data-level="3.2.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#second-level-analysis"><i class="fa fa-check"></i><b>3.2.3</b> Second level: analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#code-repositories"><i class="fa fa-check"></i><b>3.3</b> Code Repositories</a><ul>
<li class="chapter" data-level="3.3.1" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#rproj-files"><i class="fa fa-check"></i><b>3.3.1</b> <code>.Rproj</code> files</a></li>
<li class="chapter" data-level="3.3.2" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#configuration-config-file"><i class="fa fa-check"></i><b>3.3.2</b> Configuration (‘config’) File</a></li>
<li class="chapter" data-level="3.3.3" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#order-files-and-subdirectories"><i class="fa fa-check"></i><b>3.3.3</b> Order Files and Subdirectories</a></li>
<li class="chapter" data-level="3.3.4" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#use-bash-scripts-to-ensure-reproducibility"><i class="fa fa-check"></i><b>3.3.4</b> Use Bash scripts to ensure reproducibility</a></li>
<li class="chapter" data-level="3.3.5" data-path="directory-structure-and-code-repositories.html"><a href="directory-structure-and-code-repositories.html#alternative-approach-for-code-repos"><i class="fa fa-check"></i><b>3.3.5</b> Alternative approach for code repos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="codingpractices.html"><a href="codingpractices.html"><i class="fa fa-check"></i><b>4</b> Coding Practices</a><ul>
<li class="chapter" data-level="4.1" data-path="codingpractices.html"><a href="codingpractices.html#organizing-scripts"><i class="fa fa-check"></i><b>4.1</b> Organizing scripts</a></li>
<li class="chapter" data-level="4.2" data-path="codingpractices.html"><a href="codingpractices.html#documenting-your-code"><i class="fa fa-check"></i><b>4.2</b> Documenting your code</a><ul>
<li class="chapter" data-level="4.2.1" data-path="codingpractices.html"><a href="codingpractices.html#file-headers"><i class="fa fa-check"></i><b>4.2.1</b> File headers</a></li>
<li class="chapter" data-level="4.2.2" data-path="codingpractices.html"><a href="codingpractices.html#comments-in-the-body-of-your-script"><i class="fa fa-check"></i><b>4.2.2</b> Comments in the body of your script</a></li>
<li class="chapter" data-level="4.2.3" data-path="codingpractices.html"><a href="codingpractices.html#function-documentation"><i class="fa fa-check"></i><b>4.2.3</b> Function documentation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="codingpractices.html"><a href="codingpractices.html#object-naming"><i class="fa fa-check"></i><b>4.3</b> Object naming</a></li>
<li class="chapter" data-level="4.4" data-path="codingpractices.html"><a href="codingpractices.html#function-calls"><i class="fa fa-check"></i><b>4.4</b> Function calls</a></li>
<li class="chapter" data-level="4.5" data-path="codingpractices.html"><a href="codingpractices.html#the-here-package"><i class="fa fa-check"></i><b>4.5</b> The <code>here</code> package</a></li>
<li class="chapter" data-level="4.6" data-path="codingpractices.html"><a href="codingpractices.html#data-inputoutput-io"><i class="fa fa-check"></i><b>4.6</b> Data input/output (I/O)</a><ul>
<li class="chapter" data-level="4.6.1" data-path="codingpractices.html"><a href="codingpractices.html#rds-vs-.rdata-files"><i class="fa fa-check"></i><b>4.6.1</b> <code>.RDS</code> vs <code>.RData</code> Files</a></li>
<li class="chapter" data-level="4.6.2" data-path="codingpractices.html"><a href="codingpractices.html#csvs"><i class="fa fa-check"></i><b>4.6.2</b> CSVs</a></li>
<li class="chapter" data-level="4.6.3" data-path="codingpractices.html"><a href="codingpractices.html#publishing-public-data"><i class="fa fa-check"></i><b>4.6.3</b> Publishing public data</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="codingpractices.html"><a href="codingpractices.html#tidyverse"><i class="fa fa-check"></i><b>4.7</b> Tidyverse</a></li>
<li class="chapter" data-level="4.8" data-path="codingpractices.html"><a href="codingpractices.html#coding-with-r-and-python"><i class="fa fa-check"></i><b>4.8</b> Coding with R and Python</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="codingstyle.html"><a href="codingstyle.html"><i class="fa fa-check"></i><b>5</b> Coding Style</a></li>
<li class="chapter" data-level="6" data-path="datamanagement.html"><a href="datamanagement.html"><i class="fa fa-check"></i><b>6</b> Data Management</a></li>
<li class="chapter" data-level="7" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>7</b> GitHub and Version Control</a></li>
<li class="chapter" data-level="8" data-path="bigdata.html"><a href="bigdata.html"><i class="fa fa-check"></i><b>8</b> Working with Big Data</a></li>
<li class="chapter" data-level="9" data-path="unix.html"><a href="unix.html"><i class="fa fa-check"></i><b>9</b> UNIX Commands</a></li>
<li class="chapter" data-level="10" data-path="commcoord.html"><a href="commcoord.html"><i class="fa fa-check"></i><b>10</b> Communication and Coordination</a><ul>
<li class="chapter" data-level="10.1" data-path="commcoord.html"><a href="commcoord.html#slack"><i class="fa fa-check"></i><b>10.1</b> Slack</a></li>
<li class="chapter" data-level="10.2" data-path="commcoord.html"><a href="commcoord.html#email"><i class="fa fa-check"></i><b>10.2</b> Email</a></li>
<li class="chapter" data-level="10.3" data-path="commcoord.html"><a href="commcoord.html#trello"><i class="fa fa-check"></i><b>10.3</b> Trello</a></li>
<li class="chapter" data-level="10.4" data-path="commcoord.html"><a href="commcoord.html#google-drive"><i class="fa fa-check"></i><b>10.4</b> Google Drive</a></li>
<li class="chapter" data-level="10.5" data-path="commcoord.html"><a href="commcoord.html#calendar-meetings"><i class="fa fa-check"></i><b>10.5</b> Calendar / Meetings</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="code-of-conduct.html"><a href="code-of-conduct.html"><i class="fa fa-check"></i><b>11</b> Code of conduct</a><ul>
<li class="chapter" data-level="11.1" data-path="code-of-conduct.html"><a href="code-of-conduct.html#group-culture"><i class="fa fa-check"></i><b>11.1</b> Group culture</a></li>
<li class="chapter" data-level="11.2" data-path="code-of-conduct.html"><a href="code-of-conduct.html#protecting-human-subjects"><i class="fa fa-check"></i><b>11.2</b> Protecting human subjects</a></li>
<li class="chapter" data-level="11.3" data-path="code-of-conduct.html"><a href="code-of-conduct.html#authorship"><i class="fa fa-check"></i><b>11.3</b> Authorship</a></li>
<li class="chapter" data-level="11.4" data-path="code-of-conduct.html"><a href="code-of-conduct.html#work-hours"><i class="fa fa-check"></i><b>11.4</b> Work hours</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>12</b> Additional Resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Proctor Foundation Data Science Handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="codingpractices" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Coding Practices</h1>
<p><em>Contributors: Kunal Mishra, Jade Benjamin-Chung, Ben Arnold</em></p>
<div id="organizing-scripts" class="section level2">
<h2><span class="header-section-number">4.1</span> Organizing scripts</h2>
<p>Just as your data “flows” through your project, data should flow naturally through a script. Very generally, you want to:</p>
<ol style="list-style-type: decimal">
<li>describe the work completed in the script in a comment header</li>
<li>source your configuration file (<code>0-config.R</code>)</li>
<li>load all of your data</li>
<li>do all your analysis/computation in order</li>
<li>save your results</li>
</ol>
<p>Each section should be “chunked together” using comments, often with many chunks in a single section. See <a href="https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master&#39;s%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/2a%20-%20Statistical-Inputs.R">this file</a> for a good example of how to cleanly organize a file in a way that follows this “flow” and functionally separate pieces of code that are doing different things. <a href="https://github.com/ben-arnold/enterics-seroepi/blob/master/R/Fig1-haiti-ab-distributions.Rmd">This is another example</a> in a <code>.Rmd</code> format, where chunking is made even more obvious by the interleaving of markdown text and R code in the same notebook file.</p>
</div>
<div id="documenting-your-code" class="section level2">
<h2><span class="header-section-number">4.2</span> Documenting your code</h2>
<div id="file-headers" class="section level3">
<h3><span class="header-section-number">4.2.1</span> File headers</h3>
<p>Every file in a project should have a header that allows it to be interpreted on its own. It should include the name of the project and a short description for what this file (among the many in your project) does specifically. You may optionally wish to include the inputs and outputs of the script as well, though the next section makes this significantly less necessary. It can be very helpful to include your name and email address as well so others can identify who wrote the code. This is unnecessary if you are using version control (<code>git/GitHub</code>) becuase that information will be tracked by commits.</p>
<pre><code>#-------------------------------------------------------------------------------
# @Organization - Example Organization
# @Project - Example Project
# @Author - Your name, and possibly email address (if appropriate)
# @Description - This file is responsible for [...]
#-------------------------------------------------------------------------------</code></pre>
<p>Consider using RStudio’s <a href="https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections">code folding</a> feature to collapse and expand different sections of your code. Any comment line with at least four trailing dashes (-), equal signs (=), or pound signs (#) automatically creates a code section. Delimiters for chunks are a personal preference and all work equally well. For example:</p>
<pre><code># Section 1 ------------------</code></pre>
<p>works equally well as</p>
<pre><code>##############################
# Section 1 ##################
##############################</code></pre>
</div>
<div id="comments-in-the-body-of-your-script" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Comments in the body of your script</h3>
<p>Commenting your code is an important part of reproducibility and helps document your code for the future. When things change or break, you’ll be thankful for comments. When you revisit code you wrote two years earlier, you’ll be thankful for comments. There’s no need to comment excessively or unnecessarily, but a comment describing what a large or complex chunk of code does is always helpful. See <a href="https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master&#39;s%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/1b%20-%20Map-Management.R">this file</a> for an example of how to comment your code and notice that comments are always in the form of:</p>
<p><code># This is a comment -- first letter is capitalized and spaced away from the pound sign</code></p>
</div>
<div id="function-documentation" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Function documentation</h3>
<p>Every function you write must include a header to document its purpose, inputs, and outputs. For any reproducible workflows, they are essential, because R is dynamically typed. This means, you can pass a <code>string</code> into an argument that is meant to be a <code>data.table</code>, or a <code>list</code> into an argument meant for a <code>tibble</code>. It is the responsibility of a function’s author to document what each argument is meant to do and its basic type. This is an example for documenting a function (inspired by <a href="https://www.oracle.com/technetwork/java/javase/documentation/index-137868.html#format">JavaDocs</a>, R’s <a href="https://blog.rstudio.com/2018/10/23/rstudio-1-2-preview-plumber-integration/">Plumber API docs</a>, and <a href="https://kbroman.org/pkg_primer/pages/docs.html">Roxygen2</a>):</p>
<pre><code>#-----------------------------------------------------------------------------
# Documentation: calc_fluseas_mean
# Usage: calc_fluseas_mean(data, yname)
# @description: Make a dataframe with rows for flu season and site
#               and the number of patients with an outcome, the total patients,
#               and the percent of patients with the outcome

# Arguments/Options:
# @param data: a data frame with variables flu_season, site, studyID, and yname
# @param yname: a string for the outcome name
# @param silent: a boolean specifying whether the function shouldn&#39;t output anything to the console (DEFAULT: TRUE)

# @return: the dataframe as described above
# @output: prints the data frame described above if silent is not True
#-----------------------------------------------------------------------------

calc_fluseas_mean = function(data, yname, silent = TRUE) {
 ### function code here 

}</code></pre>
<p>The header tells you what the function does, its various inputs, and how you might go about using the function to do what you want. Also notice that all optional arguments (i.e. ones with pre-specified defaults) follow arguments that require user input.</p>
<ul>
<li><p><strong>Note</strong>: As someone trying to call a function, it is possible to access a function’s documentation (and internal code) by <code>CMD-Left-Click</code>ing the function’s name in RStudio</p></li>
<li><p><strong>Note</strong>: Depending on how important your function is, the complexity of your function code, and the complexity of different types of data in your project, you can also add “type-checking” to your function with the <code>assertthat::assert_that()</code> function. You can, for example, <code>assert_that(is.data.frame(statistical_input))</code>, which will ensure that collaborators or reviewers of your project attempting to use your function are using it in the way that it is intended by calling it with (at the minimum) the correct type of arguments. You can extend this to ensure that certain assumptions regarding the inputs are fulfilled as well (i.e. that <code>time_column</code>, <code>location_column</code>, <code>value_column</code>, and <code>population_column</code> all exist within the <code>statistical_input</code> tibble).</p></li>
</ul>
</div>
</div>
<div id="object-naming" class="section level2">
<h2><span class="header-section-number">4.3</span> Object naming</h2>
<p>Generally we recommend using nouns for objects and verbs for functions. This is because functions are performing actions, while objects are not.</p>
<p>Try to make your variable names both more expressive and more explicit. Being a bit more verbose is useful and easy in the age of autocompletion! For example, instead of naming a variable <code>vaxcov_1718</code>, try naming it <code>vaccination_coverage_2017_18</code>. Similarly, <code>flu_res</code> could be named <code>absentee_flu_residuals</code>, making your code more readable and explicit.</p>
<ul>
<li>For more help, check out <a href="https://spin.atomicobject.com/2017/11/01/good-variable-names/">Be Expressive: How to Give Your Variables Better Names</a></li>
</ul>
<p>We recommend you use <strong>Snake_Case</strong>.</p>
<ul>
<li><p>Base R allows <code>.</code> in variable names and functions (such as <code>read.csv()</code>), but this goes against best practices for variable naming in many other coding languages. For consistency’s sake, <code>snake_case</code> has been adopted across languages, and modern packages and functions typically use it (i.e. <code>readr::read_csv()</code>). As a very general rule of thumb, if a package you’re using doesn’t use <code>snake_case</code>, there may be an updated version or more modern package that <em>does</em>, bringing with it the variety of performance improvements and bug fixes inherent in more mature and modern software.</p></li>
<li><p><strong>Note</strong>: you may also see <code>camelCase</code> throughout the R code you come across. This is <em>okay</em> but not ideal – try to stay consistent across all your code with <code>snake_case</code>.</p></li>
<li><p><strong>Note</strong>: there is nothing inherently wrong with using <code>.</code> in variable names, just that it goes against style best practices that are cropping up in data science, so its worth getting rid of these bad habits now.</p></li>
</ul>
</div>
<div id="function-calls" class="section level2">
<h2><span class="header-section-number">4.4</span> Function calls</h2>
<p>In a function call, use “named arguments” and separate arguments by to make your code more readable.</p>
<p>Here’s an example of what not to do when calling the function a function <code>calc_fluseas_mean</code> (defined above):</p>
<pre><code>mean_Y = calc_fluseas_mean(flu_data, &quot;maari_yn&quot;, FALSE)</code></pre>
<p>And here it is again using the best practices we’ve outlined:</p>
<pre><code>mean_Y = calc_fluseas_mean(
  data = flu_data, 
  yname = &quot;maari_yn&quot;,
  silent = FALSE
)</code></pre>
</div>
<div id="the-here-package" class="section level2">
<h2><span class="header-section-number">4.5</span> The <code>here</code> package</h2>
<p>The <code>here</code> package is one great R package that helps multiple collaborators deal with the mess that is working directories within an R project structure. Let’s say we have an R project at the path <code>/home/oski/Some-R-Project</code>. My collaborator might clone the repository and work with it at some other path, such as <code>/home/bear/R-Code/Some-R-Project</code>. Dealing with working directories and paths explicitly can be a very large pain, and as you might imagine, setting up a Config with paths requires those paths to flexibly work for all contributors to a project. This is where the <code>here</code> package comes in and this a <a href="https://github.com/jennybc/here_here">great vignette describing it</a>.</p>
<p>For more motivation on why you should use the <code>here</code> and R projects (<code>.Rproj</code>), read this excellent blog post from <a href="https://www.tidyverse.org/articles/2017/12/workflow-vs-script/">Tidyverse</a>.</p>
</div>
<div id="data-inputoutput-io" class="section level2">
<h2><span class="header-section-number">4.6</span> Data input/output (I/O)</h2>
<div id="rds-vs-.rdata-files" class="section level3">
<h3><span class="header-section-number">4.6.1</span> <code>.RDS</code> vs <code>.RData</code> Files</h3>
<p>One of the most common ways to load and save data in Base R is with the <code>load()</code> and <code>save()</code> functions to serialize multiple objects in a single <code>.RData</code> file. The biggest problems with this practice include an inability to control the names of things getting loaded in, the inherent confusion this creates in understanding older code, and the inability to load individual elements of a saved file. For this, we recommend using the RDS format to save R objects using <code>saveRDS()</code> and its complement <code>readRDS()</code>.</p>
<ul>
<li><p><strong>Note</strong>: if you have many related R objects you would have otherwise saved all together using the <code>save</code> function, the functional equivalent with <code>RDS</code> would be to create a (named) list containing each of these objects, and saving it.</p></li>
<li><p><strong>Note</strong>: there is an important caveat for <code>.rds</code> files: they are not automatically backward compatible across different versions of R! So, while they are very useful in general, beware. See, for example, this thread on <a href="https://stackoverflow.com/questions/56704638/write-a-file-using-saverds-so-that-it-is-backwards-compatible-with-old-versi">StackExchange</a>. <code>.csv</code> files embed slightly less information (typically), but are more stable across different versions of R.</p></li>
</ul>
</div>
<div id="csvs" class="section level3">
<h3><span class="header-section-number">4.6.2</span> CSVs</h3>
<p>Once again, the <code>readr</code> package as part of the Tidvyerse is great, with a much faster <code>read_csv()</code> than Base R’s <code>read.csv()</code>. For massive CSVs (&gt; 5 GB), you’ll find <code>data.table::fread()</code> to be the fastest CSV reader in any data science language out there. For writing CSVs, <code>readr::write_csv()</code> and <code>data.table::fwrite()</code> outclass Base R’s <code>write.csv()</code> by a significant margin as well.</p>
</div>
<div id="publishing-public-data" class="section level3">
<h3><span class="header-section-number">4.6.3</span> Publishing public data</h3>
<p><strong>NEVER</strong> push a dataset into the public domain (e.g., GitHub, OSF) without first checking with Ben to ensure that it is appropriately de-identified and we have approval from the sponsor and/or human subjects review board to do so.</p>
<p>If you are releasing data into the public domain, then consider making available <em>at minimum</em> a <code>.csv</code> file and a codebook of the same name (note: you should have a codebook for internal data as well). We often also make available <code>.rds</code> files as well. For example, your <code>mystudy/data/public</code> directory could include three files for a single dataset, two with the actual data in <code>.rds</code> and <code>.csv</code> formats, and a third that describes their contents:</p>
<pre><code>analysis_data_public.csv
analysis_data_public.rds
analysis_data_public_codebook.txt</code></pre>
<p>In general, datasets are usually too big to save on GitHub, but occasionally they are small. Here is an example of where we actually pushed the data directly to GitHub: <a href="https://github.com/ben-arnold/enterics-seroepi/tree/master/data" class="uri">https://github.com/ben-arnold/enterics-seroepi/tree/master/data</a> . If you inspect the codebooks you can see an example of what they could contain (overview, variable descriptions, references).</p>
<p>If the data are bigger, then maintaining them under version control in your git repository can be unweildy. Instead, we recommend using another stable repository that has version control, such as the Open Science Framework (<a href="https://osf.io">osf.io</a>). For example, all of the data from the WASH Benefits trials (led by investigators at Berkeley, icddr,b, IPA-Kenya and others) are all stored through data components nested within in OSF projects: <a href="https://osf.io/tprw2/" class="uri">https://osf.io/tprw2/</a>.</p>
</div>
</div>
<div id="tidyverse" class="section level2">
<h2><span class="header-section-number">4.7</span> Tidyverse</h2>
<p>Throughout this document there have been references to the Tidyverse, but this section is to explicitly show you how to transform your Base R tendencies to Tidyverse (or Data.Table, Tidyverse’s performance-optimized competitor). For most of our work that does not utilize very large datasets, we recommend that you code in Tidyverse rather than Base R. Tidyverse is quickly becoming <a href="https://rviews.rstudio.com/2017/06/08/what-is-the-tidyverse/">the gold standard</a> in R data analysis and modern data science packages and code should use Tidyverse style and packages unless there’s a significant reason not to (i.e. big data pipelines that would benefit from Data.Table’s performance optimizations).</p>
<p>The package author has published a <a href="https://r4ds.had.co.nz/">great textbook on R for Data Science</a>, which leans heavily on many Tidyverse packages and may be worth checking out.</p>
<p>The following list is not exhaustive, but is a compact overview to begin to translate Base R into something better:</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Base R</th>
<th>Better Style, Performance, and Utility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>_</td>
<td>_</td>
</tr>
<tr class="even">
<td><code>read.csv()</code></td>
<td><code>readr::read_csv()</code> or <code>data.table::fread()</code></td>
</tr>
<tr class="odd">
<td><code>write.csv()</code></td>
<td><code>readr::write_csv()</code> or <code>data.table::fwrite()</code></td>
</tr>
<tr class="even">
<td><code>readRDS</code></td>
<td><code>readr::read_rds()</code></td>
</tr>
<tr class="odd">
<td><code>saveRDS()</code></td>
<td><code>readr::write_rds()</code></td>
</tr>
<tr class="even">
<td>_</td>
<td>_</td>
</tr>
<tr class="odd">
<td><code>data.frame()</code></td>
<td><code>tibble::tibble()</code> or <code>data.table::data.table()</code></td>
</tr>
<tr class="even">
<td><code>rbind()</code></td>
<td><code>dplyr::bind_rows()</code></td>
</tr>
<tr class="odd">
<td><code>cbind()</code></td>
<td><code>dplyr::bind_cols()</code></td>
</tr>
<tr class="even">
<td><code>df$some_column</code></td>
<td><code>df %&gt;% dplyr::pull(some_column)</code></td>
</tr>
<tr class="odd">
<td><code>df$some_column = ...</code></td>
<td><code>df %&gt;% dplyr::mutate(some_column = ...)</code></td>
</tr>
<tr class="even">
<td><code>df[get_rows_condition,]</code></td>
<td><code>df %&gt;% dplyr::filter(get_rows_condition)</code></td>
</tr>
<tr class="odd">
<td><code>df[,c(col1, col2)]</code></td>
<td><code>df %&gt;% dplyr::select(col1, col2)</code></td>
</tr>
<tr class="even">
<td><code>merge(df1, df2, by = ..., all.x = ..., all.y = ...)</code></td>
<td><code>df1 %&gt;% dplyr::left_join(df2, by = ...)</code> or <code>dplyr::full_join</code> or <code>dplyr::inner_join</code> or <code>dplyr::right_join</code></td>
</tr>
<tr class="odd">
<td>_</td>
<td>_</td>
</tr>
<tr class="even">
<td><code>str()</code></td>
<td><code>dplyr::glimpse()</code></td>
</tr>
<tr class="odd">
<td><code>grep(pattern, x)</code></td>
<td><code>stringr::str_which(string, pattern)</code></td>
</tr>
<tr class="even">
<td><code>gsub(pattern, replacement, x)</code></td>
<td><code>stringr::str_replace(string, pattern, replacement)</code></td>
</tr>
<tr class="odd">
<td><code>ifelse(test_expression, yes, no)</code></td>
<td><code>if_else(condition, true, false)</code></td>
</tr>
<tr class="even">
<td>Nested: <code>ifelse(test_expression1, yes1, ifelse(test_expression2, yes2, ifelse(test_expression3, yes3, no)))</code></td>
<td><code>case_when(test_expression1 ~ yes1,  test_expression2 ~ yes2, test_expression3 ~ yes3, TRUE ~ no)</code></td>
</tr>
<tr class="odd">
<td><code>proc.time()</code></td>
<td><code>tictoc::tic()</code> and <code>tictoc::toc()</code></td>
</tr>
<tr class="even">
<td><code>stopifnot()</code></td>
<td><code>assertthat::assert_that()</code> or <code>assertthat::see_if()</code> or <code>assertthat::validate_that()</code></td>
</tr>
</tbody>
</table>
<p>For a more extensive set of syntactical translations to Tidyverse, you can check out <a href="https://tavareshugo.github.io/data_carpentry_extras/base-r_tidyverse_equivalents/base-r_tidyverse_equivalents.html#reshaping_data">this document</a>.</p>
<p>Working with Tidyverse within functions can be somewhat of a pain due to non-standard evaluation (NSE) semantics. If you’re an avid function writer, we’d recommend checking out the following resources:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=nERXS3ssntw">Tidy Eval in 5 Minutes</a> (video)</li>
<li><a href="https://tidyeval.tidyverse.org/index.html">Tidy Evaluation</a> (e-book)</li>
<li><a href="https://www.brodrigues.co/blog/2016-07-18-data-frame-columns-as-arguments-to-dplyr-functions/">Data Frame Columns as Arguments to Dplyr Functions</a> (blog)</li>
<li><a href="https://stackoverflow.com/questions/28125816/r-standard-evaluation-for-join-dplyr">Standard Evaluation for *_join</a> (stackoverflow)</li>
<li><a href="https://dplyr.tidyverse.org/articles/programming.html">Programming with dplyr</a> (package vignette)</li>
</ul>
</div>
<div id="coding-with-r-and-python" class="section level2">
<h2><span class="header-section-number">4.8</span> Coding with R and Python</h2>
<p>If you’re using both R and Python, you may wish to check out the <a href="https://www.rdocumentation.org/packages/feather/versions/0.3.3">Feather package</a> for exchanging data between the two languages <a href="https://blog.rstudio.com/2016/03/29/feather/">extremely quickly</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="directory-structure-and-code-repositories.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="codingstyle.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["dcc-handbook.pdf", "dcc-handbook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
